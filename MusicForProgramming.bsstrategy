//
//  MusicForProgramming.plist
//  BeardedSpice
//
//  Created by Max Borghino on 12/01/15.
//  Copyright (c) 2015 Tyler Rhodes / Jose Falcon. All rights reserved.
//
// strategy/site notes
// - single sets are long, so next/prev implements the site's forward/rewind on the set
// - track info consists only of the set number and name, no artist or artwork
BSStrategy = {
  version: 2,
  displayName: "MusicForProgramming",
  accepts: {
    method: "predicateOnTab",
    format: "%K LIKE[c] '*musicforprogramming.net/*'",
    args: ["URL"],
  },
  findElement: function (regex, tag) {
    var elements = document.querySelectorAll(`nav ${tag}`);
    if (!elements) return;
    var matches = Array.prototype.filter.call(elements, function (element) {
      return RegExp(regex).test(element.textContent);
    });
    return matches;
  },
  clickElement: function (elements) {
    if (elements === undefined) return;
    if (elements.length === 0) return;
    elements[0].click();
  },
  isPlaying: function () {
    return (BSStrategy.findElement("stop", "button").length > 0);
  },
  toggle: function () {
    const button = BSStrategy.findElement("(play|stop)", "> span");
    BSStrategy.clickElement(button);
  },
  next: function () {
    const button = BSStrategy.findElement("next", "button");
    BSStrategy.clickElement(button);
  },
  favorite: function () {
    const button = BSStrategy.findElement("favourite", "> span");
    BSStrategy.clickElement(button);
  },
  previous: function () {
    const button = BSStrategy.findElement("prev", "button");
    BSStrategy.clickElement(button);
  },
  pause: function () {
    const button = BSStrategy.findElement("stop", "button");
    BSStrategy.clickElement(button);
  },
  trackInfo: function () {
    var track = document.querySelector("#content .title");
    return {
      track: track ? track.innerText : "",
    };
  },
};
